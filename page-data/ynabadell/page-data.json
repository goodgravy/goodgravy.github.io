{"componentChunkName":"component---src-templates-post-tsx","path":"/ynabadell/","result":{"data":{"site":{"siteMetadata":{"title":"jmsbrdy"}},"markdownRemark":{"id":"babdc0dc-665c-5e2c-ae9e-cf70cc3752a1","excerpt":"We’ve recently started using You Need A Budget (YNAB) to plan our finances. Unfortunately, like most finance apps it’s focussed squarely on the north american market: its automatic transaction importing only works for some US and Canadian banks – and we live and bank in Spain… YNAB does support a manual process, where you upload QFX or OFX files – or CSVs (in their required format). However, our bank (Sabadell) supports neither QFX nor OFX, and their CSV format is markedly different from that which YNAB expects in the upload. We were stuck with the prospect of importing every single transaction by hand, or manually downloading a CSV from Sabadell and munging it into a shape that YNAB can understand. Surely we can do better?","html":"<p>We’ve recently started using You Need A Budget (<a href=\"https://www.youneedabudget.com/\">YNAB</a>) to plan our finances. Unfortunately, like most finance apps it’s focussed squarely on the north american market: its automatic transaction importing only works for some US and Canadian banks – and we live and bank in Spain…</p>\n<p>YNAB <strong>does</strong> support a manual process, where you upload QFX or OFX files – or CSVs (in their required format). However, our bank (<a href=\"https://www.bancsabadell.com\">Sabadell</a>) supports neither QFX nor OFX, and their CSV format is markedly different from that which YNAB expects in the upload. We were stuck with the prospect of importing every single transaction by hand, or manually downloading a CSV from Sabadell and munging it into a shape that YNAB can understand.</p>\n<p>Surely we can do better?</p>\n<!-- excerpt -->\n<p>So became <a href=\"https://github.com/goodgravy/ynabadell\"><strong>ynabadell</strong></a> – a tool to automatically import transactions from Sabadell into your YNAB ledger.</p>\n<p>Technically speaking, <strong>ynabadell</strong> resembles an ETL system in many ways:</p>\n<ol>\n<li><strong>Extract</strong> transactions from Sabadell’s online banking</li>\n<li><strong>Transform</strong> the transactions into the format expected by YNAB</li>\n<li><strong>Load</strong> the transactions into YNAB via API</li>\n</ol>\n<p>If you just want to use the tool, feel free to look at <a href=\"https://github.com/goodgravy/ynabadell/blob/master/README.md\">the instructions</a>. If you’re looking for more information on how it works – or how you might tackle creating a similar tool for other banks – keep reading:</p>\n<h1 id=\"the-extractor\" style=\"position:relative;\"><a href=\"#the-extractor\" aria-label=\"the extractor permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Extractor</h1>\n<p>This component grabs transactions from Sabadell’s online banking, in their CSV format. I use <a href=\"https://github.com/GoogleChrome/puppeteer\">Puppeteer</a> as a headless browser to sign into Sabadell and grab the transaction data.</p>\n<p>The main things which stood out to me while creating this component is that Sabadell’s website is <strong>extremely</strong> painful to navigate in a headless browser. There is very little semantic markup, lots of jumbled-up table layouts sat alongside – or inside – div-based layouts, and mixed natural languages in the structure (e.g. Spanish and English class- and input-names).</p>\n<p>As such, I’m expecting to need to regularly tweak and fix the selector rules – they are perilously fragile. A few other caveats:</p>\n<ul>\n<li>The extractor downloads transactions for the last month. This would be easy to configure differently if you wanted to, but in its current form it expects the ETL to be run at least once monthly to get a complete ledger in YNAB. Duplicate imported transactions aren’t a concern (see <a href=\"#the-loader\">The Loader</a>, below).</li>\n<li>I’ve only run the extractor against our personal account. It’s entirely possible that if you have more or fewer accounts, or they’re arranged differently in the Overview page the extractor will get confused and not work properly for you. In this case, I would love a PR if you can find a way of driving Puppeteer in a way which works both for you and for me!</li>\n</ul>\n<p>The end result of the extractor is a list of <code class=\"language-text\">SabadellTransaction</code> value objects, which will be passed into…</p>\n<h1 id=\"the-transformer\" style=\"position:relative;\"><a href=\"#the-transformer\" aria-label=\"the transformer permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Transformer</h1>\n<p>Probably the simplest component: all the transformer does is create a <code class=\"language-text\">YNABTransaction</code> value object for each <code class=\"language-text\">SabadellTransaction</code> it is given.</p>\n<p>You can take a look at <a href=\"https://github.com/goodgravy/ynabadell/blob/master/transformer.js\">the code</a> if you’d like, but there’s not too much to it.</p>\n<p>Each <code class=\"language-text\">YNABTransaction</code> that the transformer emits is passed into…</p>\n<h1 id=\"the-loader\" style=\"position:relative;\"><a href=\"#the-loader\" aria-label=\"the loader permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The Loader</h1>\n<p>Thankfully, YNAB has a <a href=\"https://api.youneedabudget.com/\">nice API</a> which supports many different operations – the one we’re interested in is the ability to <a href=\"https://api.youneedabudget.com/v1#/Transactions/createTransaction\">upload new transactions</a> into a particular account.</p>\n<p>In the extraction section above, I noted that duplicate transactions weren’t a concern. This is because the YNAB API conveniently allows for idempotency through an <code class=\"language-text\">import_id</code> which you can include alongside every transaction. If you upload two transactions with the same <code class=\"language-text\">import_id</code>, the latter one is ignored as a duplicate – even if the data are different.</p>\n<p>YNAB uses this approach to generate <code class=\"language-text\">import_id</code> fields:</p>\n<blockquote>\n<p>… this field is a unique (by account) import identifier. If this transaction was imported through File Based Import or Direct Import and not through the API, the import<em>id will have the format: ‘YNAB:[milliunit</em>amount]:[iso_date]:[occurrence]’. For example, a transaction dated 2015-12-30 in the amount of -$294.23 USD would have an import<em>id of ‘YNAB:-294230:2015-12-30:1’. If a second transaction on the same account was imported and had the same date and same amount, its import</em>id would be ‘YNAB:-294230:2015-12-30:2’.</p>\n</blockquote>\n<p>I chose to follow this same approach for <code class=\"language-text\">import_id</code> generation in <strong>ynabadell</strong> so that you can make a smooth transition from manual CSV uploads – the two systems will work properly in conjunction with one another.</p>\n<p>Apart from the <code class=\"language-text\">import_id</code>, really the only interesting thing which isn’t supplied in the <code class=\"language-text\">YNABTransaction</code> is the access token – it’s easy to get your own YNAB personal access token by following the README instructions.</p>\n<h1 id=\"putting-it-all-together\" style=\"position:relative;\"><a href=\"#putting-it-all-together\" aria-label=\"putting it all together permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Putting it all together</h1>\n<p>Currently, <strong>ynabadell</strong> is designed to be run as a <code class=\"language-text\">launchctl</code> service on OS X.</p>\n<p>A plist file is supplied which will need to be customised to your needs. It just runs the top-level script which is responsible for reading in configuration, and then stringing together the extractor, transformer, and loader.</p>","frontmatter":{"title":"ynabadell: connect your Sabadell bank account with YNAB","description":null,"keywords":["javascript","node","ynab","you need a budget","import","export","api","sabadell"],"coverImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAIDBf/EABQBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAe9GkDQT/8QAGRAAAwADAAAAAAAAAAAAAAAAAQIQABES/9oACAEBAAEFAsJ1WXqf/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8BJ//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABgQAAMBAQAAAAAAAAAAAAAAAAABETEQ/9oACAEBAAE/IYL31EV4Q//aAAwDAQACAAMAAAAQaM//xAAWEQEBAQAAAAAAAAAAAAAAAAARECH/2gAIAQMBAT8QDs//xAAXEQADAQAAAAAAAAAAAAAAAAABEBFB/9oACAECAQE/EDcX/8QAGhABAQEAAwEAAAAAAAAAAAAAAREAITFBEP/aAAgBAQABPxAyTCk8wUGd/OcBV49xB27/2Q==","aspectRatio":1.5015015015015014,"src":"/static/5e4cabfb2d00833c20ab32486762ca0c/a41d1/piggy.jpg","srcSet":"/static/5e4cabfb2d00833c20ab32486762ca0c/0f3a1/piggy.jpg 500w,\n/static/5e4cabfb2d00833c20ab32486762ca0c/a7715/piggy.jpg 1000w,\n/static/5e4cabfb2d00833c20ab32486762ca0c/a41d1/piggy.jpg 2000w,\n/static/5e4cabfb2d00833c20ab32486762ca0c/b2131/piggy.jpg 3000w,\n/static/5e4cabfb2d00833c20ab32486762ca0c/d2452/piggy.jpg 4000w,\n/static/5e4cabfb2d00833c20ab32486762ca0c/21d0b/piggy.jpg 5184w","sizes":"(max-width: 2000px) 100vw, 2000px"}}}}}},"pageContext":{"slug":"/ynabadell/"}}}